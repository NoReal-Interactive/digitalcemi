!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TazebaoServices=t():e.TazebaoServices=t()}(self,()=>(()=>{"use strict";var e={d:(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{CemiArticle:()=>i,CemiContentService:()=>l});class i{constructor(e,t,i,s){this.id=e,this.title=t,this.media=[],this._mainText=i,this._mainUrlAudio=s,this._keywords=[]}addAlternativeText(e,t){this._alternativeText=e,this._alternativeUrlAudio=t}addSecondaryText(e,t){this._secondaryText=e,this._secondaryUrlAudio=t}addImage(e,t,i){this.media.push(new r(e,t,i))}addVideo(e,t,i){this.media.push(new o(e,t,i))}addKeyword(e){this._keywords.push(e)}getText(e){return e&&this._alternativeText?this._alternativeText:this._mainText}getSecondaryText(){return this._secondaryText}getUrlAudio(e){return e?this._alternativeUrlAudio?this._alternativeUrlAudio:null:this._mainUrlAudio}getSecondaryUrlAudio(){return this._secondaryUrlAudio?this._secondaryUrlAudio:null}hasSecondaryText(){return!!this._secondaryText}setSelectedMedia(e){this._selecetedMedia=this.media[e]}getSelectedMedia(){return this._selecetedMedia}setSelectedMediaIndex(e){this._selecetedMediaIndex=e}getSelectedMediaIndex(){return this._selecetedMediaIndex}hasKeywords(){return this._keywords.length>0}getKeywords(){return this._keywords}}class s{isImage(){return this instanceof r}isVideo(){return this instanceof o}constructor(e,t){this.title=e,this.url=t;const i=t.split("/").pop();this._thumbUrl="/data/media/images/thumbs/"+i.replace(/(\.[^/.]+)$/,"-thumb.jpg")}get thumbUrl(){return this._thumbUrl}}class r extends s{constructor(e,t,i){super(e,t),this.desc=i}}class o extends s{constructor(e,t,i){super(e,t),this.subUrl=i}}class a{constructor(){this._title="",this._subtitle="",this._articles=[],this._creditsTitle="",this._credits=[],this._bibliographyTitle="",this._bibliography=[]}get title(){return this._title}set title(e){e&&(this._title=e)}get subtitle(){return this._subtitle}set subtitle(e){e&&(this._subtitle=e)}get articles(){return this._articles}set articles(e){e&&(this._articles=e)}get creditsTitle(){return this._creditsTitle}set creditsTitle(e){e&&(this._creditsTitle=e)}get credits(){return this._credits}set credits(e){e&&(this._credits=e)}get bibliographyTitle(){return this._bibliographyTitle}set bibliographyTitle(e){e&&(this._bibliographyTitle=e)}get bibliography(){return this._bibliography}set bibliography(e){e&&(this._bibliography=e)}getArticle(e){return this.articles.find(t=>t.id==e)}}class d{constructor(e,t){this.area=e,this.contributors=t}}var n=function(e,t,i,s){return new(i||(i=Promise))(function(r,o){function a(e){try{n(s.next(e))}catch(e){o(e)}}function d(e){try{n(s.throw(e))}catch(e){o(e)}}function n(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,d)}n((s=s.apply(e,t||[])).next())})};class l{constructor(){this._media=[]}loadContent(e){return n(this,void 0,void 0,function*(){console.log("loading articles.....");let t="assets/config_json/it/config_json.json";e&&(t="assets/config_json/"+e+"/config_json.json");try{const e=yield fetch(t),i=yield e.json();console.log("content service response received");let s=new a;return s.title=i.title,s.subtitle=i.subtitle,s.creditsTitle=i.credits.title,s.credits=i.credits.items.map(e=>new d(e.area,e.contributors)),s.bibliographyTitle=i.bibliography.title,s.bibliography=i.bibliography.items,this._media=[],i.media.speeches.forEach(e=>{this._media.push(e)}),i.media.images.forEach(e=>{this._media.push(e)}),i.media.videos.forEach(e=>{this._media.push(e)}),i.media.subtitles.forEach(e=>{this._media.push(e)}),s.articles=i.articles.map(e=>this.transformToCemiArticle(e)),console.log("Cemi content created"),s}catch(e){return console.error("Error loading Cemi content:",e),new a}})}transformToCemiArticle(e){let t=this._getMedia(e.audioTN1Id),s=new i(e.id,e.title,e.TN1,t?t.url:""),r=this._getMedia(e.audioTAId);s.addAlternativeText(e.TA,r?r.url:"");let o=this._getMedia(e.audioTN2Id);return s.addSecondaryText(e.TN2,o?o.url:""),e.mediaList&&e.mediaList.forEach(e=>{let t=this._getMedia(e.id);if(t)if("image"==e.type)s.addImage("",t.url,e.desc);else if("video"==e.type){let i=this._getMedia(e.subId);s.addVideo("",t.url,i?i.url:"")}}),e.keywords&&e.keywords.forEach(e=>s.addKeyword(e)),s}_getMedia(e){return this._media.find(t=>t.id==e)}}return t})());