/*!
 * Copyright (C) 2026 No Real Interactive
 * Licensed under GNU GPL v3
 * See LICENSE file for details.
 */
let inactivityTime,inactivityTimer;!function(e){let t=null,i=null,o=[];const a=Object.freeze({MAIN:1,SECOND:2,MEDIA:3,HTML:4});function n(){$(".article-speech").each(function(){if(!this.paused){let e=this.src.split("/").pop();return ATON.fire("onEndedMedia",{mediaType:"SPEECH",fileName:e,ended:"N"}),void MicroModal.close("article-modal")}}),$(".article-video").each(function(){if(!this.paused){let e=this.currentSrc.split("/").pop();return ATON.fire("onEndedMedia",{mediaType:"VIDEO",fileName:e,ended:"N"}),void MicroModal.close("article-modal")}}),MicroModal.close("article-modal")}function s(){MicroModal.close("languages-modal")}function r(){MicroModal.close("targets-modal")}function c(){MicroModal.show("args-modal",{onClose:()=>{$("#argsBtn").removeAttr("data-active"),ATON.fire("onClickApp")}})}function l(e,s,r){if(!e)return;const c="children"===sessionStorage.getItem(sessionTagetItem),T=o.find(t=>t.id===e),h=T.id,N=s||a.MAIN,v=r||"";var A={article:T,displayType:N,parent:v};switch(ATON.fire("onTraceAction",{eventType:2,data:{action_type:h.startsWith("G")?"ARG":"HOTSPOT",action_value:h+"-"+(s==a.MEDIA?"MEDIA":s==a.SECOND?"SECOND":"MAIN")}}),$("#article-title").text(T.title),N){case a.MAIN:T.hasSecondaryText()&&!c&&function(e){var t=$("<div class='modal__btn tools-btn' data-click-audio title=''><img src='assets/icons/plus.png'></div>");t.click(function(t){ATON.fire("onClickApp"),t.stopPropagation(),n(),l(e.article.id,a.SECOND,e.article.id+"."+a.MAIN)}),t.appendTo($("#article-tools"))}(A),d(A),p(A),m(A),T.media.length>0&&u(A);break;case a.SECOND:d(A),p(A),m(A),T.media.length>0&&u(A);break;case a.MEDIA:p(A),T.media.length>0&&(!function(e){$("#article-media").show(),e.article.media.forEach((t,i)=>{var o=$('<div class="swiper-slide"></div>'),a=t.url?t.url.split("/").pop():"";if(t.isVideo()){const e=sessionStorage.getItem(sessionModeItem);let i;i=e&&"kiosk"==e?$(`<video class='article-video' controls disablePictureInPicture controlsList="nodownload noremoteplayback noplaybackrate nofullscreen disablepictureinpicture"><source src="${t.url}" type="video/webm"><track src="${t.subUrl}" kind="subtitles" srclang="it" label="Italiano" default></video>`):$(`<video class='article-video' controls controlsList="nodownload noremoteplayback noplaybackrate disablepictureinpicture"><source src="${t.url}" type="video/webm"><track src="${t.subUrl}" kind="subtitles" srclang="it" label="Italiano" default></video>`),i.on("play",()=>{ATON.fire("onClickApp"),ATON.fire("onPlayMedia",{mediaType:"VIDEO",fileName:a})}),i.on("pause",()=>{ATON.fire("onClickApp"),ATON.fire("onPauseMedia",{mediaType:"VIDEO",fileName:a})}),i.on("ended",()=>ATON.fire("onEndedMedia",{mediaType:"VIDEO",fileName:a,ended:"Y"})),i.appendTo(o),o.appendTo($("#article-media-gallery"))}else{var n=$("<figure class='slide-figure'></figure>"),s=$('<div class="panzoom-container"><div class="panzoom-icon-overlay"><img src="assets/icons/zoom-pan.png" alt=""></div></div>'),r=$(`<img id='panzoom-${e.article.id}-${i}' src='${t.url}' alt=''>`),c=$(`<figcaption>${t.desc}</figcaption>`);r.prependTo(s),s.appendTo(n),c.appendTo(n),n.appendTo(o),o.appendTo($("#article-media-gallery"))}})}(A),u(A));break;case a.HTML:d(A),p(A),function(e){$("#article-html").show();const t="children"===sessionStorage.getItem(sessionTagetItem),i=e.article.getText(t);$("#article-html").load(i)}(A),T.media.length>0&&u(A);break;default:console.log("article displayType",N)}MicroModal.show("article-modal",{onShow:(e,o,a)=>{$("#argsBtn").attr("data-active","");var n=$("#article-modal");if(n.attr("data-article-id",h),n.attr("data-display-type",N),n.attr("data-parent",v),$("#article-media-thumbs").is(":visible")){const e=T.getSelectedMediaIndex()||0,o=$("#article-media-thumbs").width(),a=$("#article-media-thumbs").height(),n=Math.round(o/a),s=$("#article-media-thumbs .swiper-slide").length>n-1;if(t=new Swiper("#thumbsSwiper",{loop:!1,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},slidesPerView:n-1,spaceBetween:16,allowTouchMove:s,initialSlide:e}),s){$(".swiper-button-prev").width()}else $("#thumbsSwiper").css("width","90%"),$("#article-media-previews").css("justify-content","center");if($("#article-media").is(":visible")){i=new Swiper("#mediaSwiper",{loop:!1,spaceBetween:16,thumbs:{swiper:t},slidesPerView:1,allowTouchMove:!1,initialSlide:e}),i.on("slideChange",function(){ATON.fire("onClickApp"),$("video").each(function(){this.pause()});const e=$(i.slides[i.activeIndex]),t=e.find("video");t.length&&(t.removeAttr("muted"),t.get(0).play().catch(e=>{console.log("Errore nella riproduzione:",e)}));const o=e.find("img");if(o.length){let e=o[0].src.split("/").pop();ATON.fire("onTraceAction",{eventType:4,data:{action:"VIEW",action_type:"IMAGE",action_value:e}})}}),i.on("slideChangeTransitionEnd",function(){const e=$(i.slides[i.activeIndex]).find("img");e.length&&g(e[0])});const o=$(i.slides[e]),a=o.find("img"),n=o.find("video");if(a.length){let e=a[0].src.split("/").pop();ATON.fire("onTraceAction",{eventType:4,data:{action:"VIEW",action_type:"IMAGE",action_value:e}}),g(a[0])}n.length&&(n.removeAttr("muted"),n.get(0).play().catch(e=>{console.log("Errore nella riproduzione:",e)}))}}},onClose:(e,o,a)=>{$("#argsBtn").removeAttr("data-active"),ATON.fire("onClickApp"),ATON.fire("playSceneSound");var n=$("#article-modal");if(n.attr("data-article-id",""),n.attr("data-display-type",""),n.attr("data-parent",""),$("#article-title").empty(),$("#article-tools").empty(),$("#article-text").empty(),$("#article-text").hide(),$("#article-html").empty(),$("#article-html").hide(),$(".panzoom-img").each(function(){const e=document.getElementById($(this).attr("id")),t=Panzoom(e);t.destroy(),e.parentElement.removeEventListener("wheel",t.zoomWithWheel),$(this).removeClass("panzoom-img")}),$("#article-media-gallery").empty(),$("#article-media").hide(),$("#article-media-previews").empty(),$("#article-media-thumbs").hide(),i){try{i.destroy()}catch(e){console.warn("Glide destroy error:",e)}i=null}if(t){try{t.destroy()}catch(e){console.warn("Glide destroy error:",e)}t=null}},awaitCloseAnimation:!1,awaitOpenAnimation:!1,debugMode:!0})}function d(e){const t="children"===sessionStorage.getItem(sessionTagetItem);var i=$("<div id='audioT' data-click-audio class='modal__btn tools-btn' title=''><img src='assets/icons/volume.png'></div>"),o=null;if(e.displayType==a.MAIN||e.displayType==a.HTML?o=e.article.getUrlAudio(t):e.displayType==a.SECOND&&(o=e.article.getSecondaryUrlAudio()),o){var n=$("<audio class='article-speech' src='' preload='auto'></audio>"),s=o.split("/").pop();n.attr("src",o),n.on("play",()=>ATON.fire("onPlayMedia",{mediaType:"SPEECH",fileName:s})),n.on("pause",()=>ATON.fire("onPauseMedia",{mediaType:"SPEECH",fileName:s})),n.on("ended",function(){this.currentTime=0,i.find("img").attr("src","assets/icons/volume.png"),ATON.fire("onEndedMedia",{mediaType:"SPEECH",fileName:s,ended:"Y"})}),i.append(n),i.click(function(){ATON.fire("onClickApp"),ATON.fire("onClickSpeech","audioT")})}else i.addClass("modal__btn-disabled");i.appendTo($("#article-tools"))}function p(e){var t=$("<div class='modal__btn tools-btn close-btn' data-click-audio title=''><img src='assets/icons/close.png'></div>");t.click(function(t){if(e.parent){t.stopPropagation();let i=e.parent.split(".")[0],o=e.parent.split(".")[1];o==a.MAIN?(n(),l(i,a.MAIN)):o==a.SECOND?(n(),l(i,a.SECOND,i+"."+a.MAIN)):o==a.HTML&&(n(),l(i,a.HTML))}else t.stopPropagation(),n(),e.article.id.startsWith("G")&&c()}),t.appendTo($("#article-tools"))}function m(e){$("#article-text").show(),0==e.article.media.length&&$("#article-text").css("max-height","100%");const t="children"===sessionStorage.getItem(sessionTagetItem);let i="";if(e.displayType==a.MAIN?i=e.article.getText(t):e.displayType==a.SECOND&&(i=e.article.getSecondaryText()),e.article.hasKeywords()){const t=e.article.getKeywords().map(e=>e.normalize("NFC")).sort((e,t)=>t.length-e.length),o=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),a=new RegExp(`(?<!\\p{L})(${t.map(o).join("|")})(?!\\p{L})`,"giu");i=i.normalize("NFC").replace(a,'<span class="article-keyword">$1</span>')}$("#article-text").html(i)}function u(e){$("#article-media-thumbs").show(),e.article.media.forEach((t,i)=>{var o=t.thumbUrl,s=$('<div class="swiper-slide" data-click-audio></div>');t.isVideo()?s.append(`<div class="poster-container"><img src='${o}' alt=""><div class="poster-overlay"></div></div>`):s.append(`<img src='${o}' />`),e.displayType!=a.MEDIA&&s.click(function(t){t.stopPropagation(),e.article.setSelectedMediaIndex(i),e.displayType==a.MAIN?(n(),l(e.article.id,a.MEDIA,e.article.id+"."+a.MAIN)):e.displayType==a.SECOND?(n(),l(e.article.id,a.MEDIA,e.article.id+"."+a.SECOND)):e.displayType==a.HTML&&(n(),l(e.article.id,a.MEDIA,e.article.id+"."+a.HTML))}),s.appendTo($("#article-media-previews"))})}function g(e){e.complete&&0!==e.naturalWidth?initPanZoom(e):e.addEventListener("load",()=>initPanZoom(e))}initPanZoom=e=>{e.classList.add("panzoom-img");const t=e.parentElement,i=e.naturalWidth,o=e.naturalHeight,a=i/t.offsetWidth,n=o/t.offsetHeight,s=Math.max(a,n).toFixed(2),r=Panzoom(e,{maxScale:s,minScale:1});t.addEventListener("wheel",r.zoomWithWheel,{passive:!1})},e.CemiModalUtils={init:function(){"undefined"!=typeof MicroModal?(MicroModal.init(),console.log("Micromodal inizializzato")):console.error("Micromodal non Ã¨ disponibile.")},isAnyArticleMediaPlaying:function(){return $(".article-speech").each(function(){if(!this.paused&&!this.ended)return!0}),$(".article-video").each(function(){if(!this.paused&&!this.ended)return!0}),!1},adjustMediaThumbs:function(){if($("#article-media-thumbs").is(":visible")){const e=$("#article-media-thumbs").width(),i=$("#article-media-thumbs").height(),o=Math.round(e/i),a=$("#article-media-thumbs .swiper-slide").length>o-1;t.params.slidesPerView=o-1,t.params.allowTouchMove=a,a||($("#thumbsSwiper").css("width","90%"),$("#article-media-previews").css("justify-content","center")),t.update()}},loadContent:function(e){o=e.articles,$("#article-links").empty(),$("#bibliography-list").empty(),$("#credits-list").empty(),e.articles.forEach(e=>{if(e.id.startsWith("G")){var t=$(`<div data-click-audio class='article-link' data-arg-id='${e.id}-c.png'><img src="assets/images/args/${e.id}-c.png" alt="Immagine quadrata" class="immagine"><div>${e.title}</div></div>`);t.click(function(t){ATON.fire("onClickApp"),MicroModal.close("args-modal"),"G06"==e.id?l(e.id,a.HTML):l(e.id,a.MAIN)}),t.appendTo($("#article-links"))}}),$("#bibliography-title").text(e.bibliographyTitle),e.bibliography.forEach(e=>{$(`<li><span>${e}</span></li>`).appendTo($("#bibliography-list"))}),$("#credits-title").text(e.creditsTitle),e.credits.forEach(e=>{var t=$(`<li><span><strong>${e.area}</strong></span></li>`);e.contributors.forEach(e=>{$(`</br><span>${e}</span>`).appendTo(t)}),t.appendTo($("#credits-list"))})},closeAll:function(){$("#article-modal").is(":visible")&&n(),$("#languages-modal").is(":visible")&&s(),$("#targets-modal").is(":visible")&&r(),$("#args-modal").is(":visible")&&MicroModal.close("args-modal"),$("#bibliography-modal").is(":visible")&&MicroModal.close("bibliography-modal"),$("#credits-modal").is(":visible")&&MicroModal.close("credits-modal")},closeArticle:n,closeLanguages:s,closeTargets:r,showArticle:l,showLanguages:function(){const e=sessionStorage.getItem(sessionLanguageItem);var t=$("#languagesBtn").offset().top;$("#cemi-toolbar").width(),$("#languages-modal-container").css({top:t+"px"}),$(".lang-btn").each(function(){e&&e==$(this).attr("data-lang")?$(this).addClass("modal__btn-disabled"):$(this).removeClass("modal__btn-disabled")}),MicroModal.show("languages-modal",{onClose:()=>{$("#languagesBtn").removeAttr("data-active"),ATON.fire("onClickApp")}})},showTargets:function(){const e=sessionStorage.getItem(sessionTagetItem);var t=$("#targetsBtn").offset().top;$("#targets-modal-container").css({top:t+"px"}),$(".target-btn").each(function(){e&&e==$(this).attr("data-target")?$(this).addClass("modal__btn-disabled"):$(this).removeClass("modal__btn-disabled")}),MicroModal.show("targets-modal",{onClose:()=>{$("#targetsBtn").removeAttr("data-active"),ATON.fire("onClickApp")}})},showArgs:c,showBibliography:function(){MicroModal.show("bibliography-modal",{onClose:()=>{$("#bibliographyBtn").removeAttr("data-active"),ATON.fire("onClickApp")}})},showCredits:function(){MicroModal.show("credits-modal",{onClose:()=>{$("#creditsBtn").removeAttr("data-active"),ATON.fire("onClickApp")}})}}}(window);let swiper,articleMediaPlaying=!1;const sessionModeItem="MODE",sessionLanguageItem="LANG",sessionTagetItem="TARGET",sessionNodeItem="NODE",sessionStartItem="START",cemiContentService=new TazebaoServices.CemiContentService,loadOptions={startAnimation:!1},nodeOptions={updateLight:!1},cemiEsternoNodeId="esterno",cemiEsternoUrl="models/cemi-esterno/Zemi_esterno.gltf",cemiEsternoHotspotNodeId="esterno-hotspots",cemiEsternoHotspotConfig=[{id:"H01",position:new THREE.Vector3(-.036589,.460728,-.054054),radius:.008},{id:"H02",position:new THREE.Vector3(.001985,.38571,-.028309),radius:.008},{id:"H03",position:new THREE.Vector3(.005831,.270009,-.03595),radius:.008},{id:"H04",position:new THREE.Vector3(.008475,.194636,-.013873),radius:.008},{id:"H05",position:new THREE.Vector3(.060161,.165002,-.14742),radius:.008},{id:"H06",position:new THREE.Vector3(-.016822,.413825,-.179356),radius:.008}],cemiInternoNodeId="interno",cemiInternoUrl="models/cemi-interno/Zemi_interno.gltf",cemiInternoHotspotNodeId="interno-hotspots",cemiInternoHotspotConfig=[{id:"H07",position:new THREE.Vector3(.012092,.278645,-.035881),radius:.008},{id:"H08",position:new THREE.Vector3(.003286,.516783,-.075272),radius:.008}];function startSession(){sessionStorage.setItem("START",(new Date).toISOString()),sessionStorage.setItem(sessionLanguageItem,"it"),sessionStorage.setItem("NODE","esterno"),sessionStorage.setItem(sessionTagetItem,"generic")}function clearSession(){sessionStorage.removeItem("START",(new Date).toISOString()),sessionStorage.removeItem(sessionLanguageItem,"ITA"),sessionStorage.removeItem("NODE","esterno"),sessionStorage.removeItem(sessionTagetItem,"generic"),loadContent("it","ITA"),setTarget("generic")}function _resetInactivityTimer(){clearTimeout(inactivityTimer),inactivityTimer=setTimeout(()=>{_showIntro(),ATON.Nav.requestHome(1),setNode("esterno"),CemiModalUtils.closeAll(),_mtmPushEvent(cemiEventTypes.SESSION,{action:"EXPIRE"}),clearSession()},inactivityTime)}function _pauseInactivityTimer(){clearTimeout(inactivityTimer),inactivityTimer=null}function _showIntro(){swiper?($("#introOverlay").css("display","block").css("opacity","0").css("transition","opacity 0.5s ease"),setTimeout(()=>{$("#introOverlay").css("opacity","1"),swiper.update(),swiper.autoplay.start()},10)):console.log("swiper not initialized")}function _hideIntro(){swiper?($("#introOverlay").css("transition","opacity 0.5s ease").css("opacity","0"),setTimeout(()=>{$("#introOverlay").css("display","none"),swiper.autoplay.stop(),_resetInactivityTimer()},500)):console.log("swiper not initialized")}function changeLanguage(e,t){sessionStorage.setItem(sessionLanguageItem,e),loadContent(e,t)}function loadContent(e,t){$("#languagesBtn img").attr("src","assets/icons/"+t.toUpperCase()+".png"),cemiContentService.loadContent(e).then(t=>{console.log("content loaded",e),$("#title").text(t.title),$("#subtitle").text(t.subtitle),CemiModalUtils.loadContent(t)})}function changeTarget(e){sessionStorage.setItem(sessionTagetItem,e),setTarget(e)}function setTarget(e){$("#targetsBtn img").attr("src","assets/icons/"+("children"==e?"target-kid":"target-adult")+".png"),$("body").css("background-image","children"==e?'url("assets/images/background-color.jpg")':'url("assets/images/background.jpg")')}function changeNode(e){setNode(e),sessionStorage.setItem("NODE",e)}function setNode(e){"interno"===e?(ATON.getSceneNode("esterno").hide(nodeOptions),ATON.getSemanticNode("esterno-hotspots").hide(nodeOptions),ATON.getSceneNode("interno").show(nodeOptions),ATON.getSemanticNode("interno-hotspots").show(nodeOptions)):"esterno"===e&&(ATON.getSceneNode("interno").hide(nodeOptions),ATON.getSemanticNode("interno-hotspots").hide(nodeOptions),ATON.getSceneNode("esterno").show(nodeOptions),ATON.getSemanticNode("esterno-hotspots").show(nodeOptions))}setup=()=>{CemiModalUtils.init(),swiper=new Swiper("#introSwiper",{effect:"fade",fadeEffect:{crossFade:!0},loop:!0,speed:2e3,autoplay:{delay:1e4,disableOnInteraction:!1},pagination:{enabled:!1},navigation:{enabled:!1},allowTouchMove:!1,on:{slideChangeTransitionStart:function(){document.querySelector(".swiper-slide-active img").classList.add("kenburns")}}}),document.querySelector(".swiper-slide-active img").classList.add("kenburns");const e=$("#click-sound")[0],t=$("#scene-sound")[0];t.volume=1,ATON.realize(),addBasicEvents(),ATON.setBackgroundColor(null),ATON.setAutoLP(!0),ATON.setMainLightDirection(new THREE.Vector3(-.1,-1,-1)),ATON.setMainPanorama("pano/HDRI_Zemi_4.hdr"),ATON.setMainPanoramaRotation(114),ATON.setExposure(1.3),ATON.createSceneNode("esterno").load(cemiEsternoUrl,()=>{console.log("cemi esterno loaded")},loadOptions).attachToRoot().disablePicking(),ATON.createSceneNode("interno").load(cemiInternoUrl,()=>{console.log("cemi interno loaded")},loadOptions).attachToRoot().disablePicking();const i=ATON.MatHub.getMaterial("semanticShapeHL"),o=new THREE.MeshBasicMaterial({color:16776960,transparent:!0,opacity:.9});gsap.to(o,{opacity:.1,duration:1,repeat:-1,yoyo:!0,ease:"sine.inOut"}),ATON.createSemanticNode("esterno-hotspots").attachToRoot(),cemiEsternoHotspotConfig.forEach(e=>{ATON.createSemanticNode(e.id).attachTo("esterno-hotspots"),ATON.SemFactory.createSphere(e.id,e.position,e.radius).setMaterial(o).setDefaultAndHighlightMaterials(o,i)}),ATON.createSemanticNode("interno-hotspots").attachToRoot(),cemiInternoHotspotConfig.forEach(e=>{if(ATON.createSemanticNode(e.id).attachTo("interno-hotspots"),ATON.SemFactory.createSphere(e.id,e.position,e.radius).setMaterial(o).setDefaultAndHighlightMaterials(o,i),"H07"==e.id){const t=ATON.createSceneNode("H07-line"),i=e.position.clone(),a=new THREE.Vector3(i.x,i.y,i.z-.047),n=(new THREE.BufferGeometry).setFromPoints([i,a]),s=new THREE.Line(n,o);t.add(s),t.attachTo("interno")}});const a=_.throttle(function(){$("#introOverlay").is(":visible")||articleMediaPlaying||_resetInactivityTimer()},1e3,{trailing:!1});$(document).on("mousemove click keydown scroll touchstart",a),$("#startBtn").click(()=>{ATON._screenPointerCoords.x=-1,ATON._screenPointerCoords.y=1,_hideIntro(),ATON.fire("onClickApp",{eventType:cemiEventTypes.SESSION,data:{action:"START"}}),startSession(),ATON.fire("playSceneSound")}),$("#languagesBtn").click(()=>{ATON.fire("onClickApp"),$("#languagesBtn").attr("data-active",""),CemiModalUtils.showLanguages()}),$("#targetsBtn").click(()=>{ATON.fire("onClickApp"),$("#targetsBtn").attr("data-active",""),CemiModalUtils.showTargets()}),$("#xrayBtn").click(()=>{const e=sessionStorage.getItem("NODE");e&&("esterno"===e?(ATON.fire("onClickApp",{eventType:cemiEventTypes.CHANGE,data:{action_type:"MODEL",action_value:"interno"}}),changeNode("interno")):"interno"===e&&(ATON.fire("onClickApp",{eventType:cemiEventTypes.CHANGE,data:{action_type:"MODEL",action_value:"esterno"}}),changeNode("esterno")))}),$("#argsBtn").click(()=>{ATON.fire("onClickApp",{eventType:cemiEventTypes.CONTENT,data:{action_type:"SECTION",action_value:"ARGS"}}),$("#argsBtn").attr("data-active",""),CemiModalUtils.showArgs()}),$("#bibliographyBtn").click(()=>{ATON.fire("onClickApp",{eventType:cemiEventTypes.CONTENT,data:{action_type:"SECTION",action_value:"BIBLIOGRAPHY"}}),$("#bibliographyBtn").attr("data-active",""),CemiModalUtils.showBibliography()}),$("#creditsBtn").click(()=>{ATON.fire("onClickApp",{eventType:cemiEventTypes.CONTENT,data:{action_type:"SECTION",action_value:"CREDITS"}}),$("#creditsBtn").attr("data-active",""),CemiModalUtils.showCredits()}),$("#surveyBtn").click(()=>{ATON.fire("onClickApp",{eventType:cemiEventTypes.CONTENT,data:{action_type:"SECTION",action_value:"SURVEY"}});var e=$("#surveyBtn").attr("data-src");e&&window.open(e,"_blank")}),$("#idView3D").click(()=>{var e=ATON.getHoveredSemanticNode();e&&e.nid&&(ATON.fire("onClickApp"),ATON._screenPointerCoords.x=-1,ATON._screenPointerCoords.y=1,CemiModalUtils.showArticle(e.nid))}),$(".lang-btn").click(e=>{var t=$(e.currentTarget).attr("data-lang"),i=$(e.currentTarget).attr("data-label");ATON.fire("onClickApp",{eventType:cemiEventTypes.CHANGE,data:{action_type:"LANG",action_value:t}}),changeLanguage(t,i),CemiModalUtils.closeLanguages()}),$(".target-btn").click(e=>{var t=$(e.currentTarget).attr("data-target");ATON.fire("onClickApp",{eventType:cemiEventTypes.CHANGE,data:{action_type:"TARGET",action_value:t}}),changeTarget(t),CemiModalUtils.closeTargets()}),ATON.on("onClickApp",t=>{t&&_mtmPushEvent(t.eventType,t.data),e.play().catch(e=>{console.error("Errore durante la riproduzione audio:",e)})}),ATON.on("onTraceAction",e=>{_mtmPushEvent(e.eventType,e.data)}),ATON.on("pauseSceneSound",()=>{t.pause()}),ATON.on("playSceneSound",()=>{t.paused&&t.play().catch(e=>{console.error("Errore durante la riproduzione audio:",e)})}),ATON.on("toggleSceneSound",()=>{t.paused?t.play().catch(e=>{console.error("Errore durante la riproduzione audio:",e)}):t.pause()}),ATON.on("onClickSpeech",function(e){const t=$("#"+e),i=t.find("audio")[0];if(i.paused){const e=i.play();void 0!==e&&e.then(()=>{t.find("img").attr("src","assets/icons/pause.png")}).catch(e=>{console.error("Errore durante la riproduzione audio:",e)})}else i.pause(),t.find("img").attr("src","assets/icons/volume.png")}),ATON.on("onPlayMedia",function(e){_mtmPushEvent(cemiEventTypes.MEDIA,{action:"PLAY",action_type:e.mediaType,action_value:e.fileName}),articleMediaPlaying=!0,_pauseInactivityTimer()}),ATON.on("onPauseMedia",function(e){_mtmPushEvent(cemiEventTypes.MEDIA,{action:"PAUSE",action_type:e.mediaType,action_value:e.fileName}),articleMediaPlaying=!1,_resetInactivityTimer()}),ATON.on("onEndedMedia",function(e){_mtmPushEvent(cemiEventTypes.MEDIA,{action:"Y"==e.ended?"END":"STOP",action_type:e.mediaType,action_value:e.fileName}),articleMediaPlaying=!1,_resetInactivityTimer()}),ATON.on("LPsUpdated",()=>{console.log("LPsUpdated"),ATON._matMainPano.colorWrite=!1,$("#idView3D").css("visibility","visible")}),ATON.on("MobileLandscapeMode",()=>{setTimeout(()=>{CemiModalUtils.adjustMediaThumbs()},100)}),ATON.on("MobilePortraitMode",()=>{setTimeout(()=>{CemiModalUtils.adjustMediaThumbs()},100)}),$.getJSON("app.config.json",e=>{inactivityTime=e.inactivityTime||12e4,e.minDistanceControls&&(ATON.Nav._controls.minDistance=e.minDistanceControls),e.maxDistanceControls&&(ATON.Nav._controls.maxDistance=e.maxDistanceControls),e.rotateSpeed&&(ATON.Nav._controls.rotateSpeed=e.rotateSpeed),e.sceneSoundVolume&&(t.volume=e.sceneSoundVolume),ATON.Nav._controls.enablePan=e.enablePan,ATON.SUI.showSelector(e.showSelector),ATON.toggleAdaptiveDensity(e.toggleAdaptiveDensity),"kiosk"==e.mode&&$("#cemi-header-right").css("display","flex"),e.surveyUrl?$("#surveyBtn").attr("data-src",e.surveyUrl):$("#surveyBtn").hide(),sessionStorage.setItem(sessionModeItem,e.mode),loadContent("it","ITA"),setTarget("generic")})},update=()=>{},addBasicEvents=()=>{ATON.on("NodeRequestFired",e=>{console.log("NodeRequestFired",e),ATON.UI.showCenteredOverlay()}),ATON.on("NodeRequestCompleted",e=>{console.log("NodeRequestCompleted",e)}),ATON.on("AllNodeRequestsCompleted",()=>{ATON.UI.hideCenteredOverlay(),ATON.UI._bReqHome||(ATON.Nav.homePOV||ATON.Nav.computeAndRequestDefaultHome(.5),ATON.Nav.requestHomePOV(.2),ATON.UI._bReqHome=!0,console.log("AllNodeRequestsCompleted homePOV:",ATON.Nav.homePOV),ATON.getSceneNode("interno").hide(nodeOptions),ATON.getSemanticNode("interno-hotspots").hide(nodeOptions),window.electronAPI&&window.electronAPI.notifyAssetsReady())}),ATON.on("SemanticNodeHover",e=>{let t=ATON.getSemanticNode(e);void 0!==t&&(t.highlight(),document.querySelector("canvas").style.cursor="pointer",setTimeout(()=>{ATON._screenPointerCoords.x=-1,ATON._screenPointerCoords.y=1},500))}),ATON.on("SemanticNodeLeave",e=>{let t=ATON.getSemanticNode(e);void 0!==t&&(t.restoreDefaultMaterial(),document.querySelector("canvas").style.cursor="grab")}),ATON.addUpdateRoutine(()=>{})};const cemiEventTypes=Object.freeze({CHANGE:1,CONTENT:2,SESSION:3,MEDIA:4});function _mtmPushEvent(e,t){if(!window._mtm)return;let i={context_lang:sessionStorage.getItem(sessionLanguageItem),context_target:sessionStorage.getItem(sessionTagetItem),context_model:sessionStorage.getItem("NODE"),context_start:sessionStorage.getItem("START"),context_mode:sessionStorage.getItem(sessionModeItem),action:t.action?t.action:"",action_type:t.action_type?t.action_type:"",action_value:t.action_value?t.action_value:""};switch(e){case cemiEventTypes.CHANGE:i.event="CHANGE",i.action="CHANGE";break;case cemiEventTypes.CONTENT:i.event="CONTENT",i.action="VIEW";break;case cemiEventTypes.MEDIA:i.event="MEDIA";break;case cemiEventTypes.SESSION:i.event="SESSION";break;default:console.log("_mtmPushEvent","UNKNOWN")}window._mtm.push(i)}let APP=ATON.App.realize(setup,update);window.APP=APP,ATON.setAsStandalone(),ATON.setPathCollection("/data/");